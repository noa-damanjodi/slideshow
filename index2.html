<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slideshow Debug</title>
<style>
  body { margin:0; background:#000; overflow:hidden; font-family:Arial; }
  #slideshow { position:fixed; top:0; left:0; width:100vw; height:100vh; background:black; overflow:hidden; }
  #slideshow img { width:110vw; height:110vh; object-fit:cover; position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%); opacity:0; transition:opacity 1.5s ease; }
  #status {
    position:fixed; top:10px; left:10px; right:10px;
    color:#0f0; font-size:14px; z-index:9999;
    background:rgba(0,0,0,.6); padding:10px; border-radius:10px;
    white-space:pre-wrap;
  }
</style>
</head>
<body>

<div id="status">Status: Loading…</div>
<div id="slideshow"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxVJbEXzRdQzTXiX4N9p4HQhySI1VGJcOXhdVjk6py_XFWuyZtA1KPmVWQvAnGhhXmm/exec";
const SLIDE_DURATION = 5000;

let photos = [];
let imgs = [];
let index = 0;

function setStatus(msg){
  document.getElementById("status").textContent = msg;
  console.log(msg);
}

function loadImages(){
  const slideshow = document.getElementById("slideshow");
  slideshow.innerHTML = "";

  photos.forEach((src,i) => {
    const img = document.createElement("img");

    img.onload = () => console.log("✅ IMG LOADED:", i, src);
    img.onerror = () => console.log("❌ IMG FAILED:", i, src);

    img.src = src;
    slideshow.appendChild(img);
  });

  imgs = document.querySelectorAll("#slideshow img");
  setStatus("Images added to DOM: " + imgs.length);
}

function startSlideshow(){
  if(!imgs.length){
    setStatus("No images found. Slideshow not started.");
    return;
  }

  function showSlide(){
    imgs.forEach(im => im.style.opacity = 0);
    imgs[index].style.opacity = 1;
    index = (index + 1) % imgs.length;
  }

  showSlide();
  setInterval(showSlide, SLIDE_DURATION);
  setStatus("Slideshow started ✅ Total images: " + imgs.length);
}

function loadFromAPI_JSONP(){
  setStatus("Loading API via JSONP…");

  const cbName = "cb_" + Date.now();

  window[cbName] = function(data){
    setStatus("JSONP callback received ✅");
    delete window[cbName];

    if(!data || !data.photos || !data.photos.length){
      setStatus("API returned no photos ❌");
      return;
    }

    setStatus("Photos received: " + data.photos.length);
    photos = data.photos.slice();

    loadImages();
    setTimeout(startSlideshow, 800);
  };

  const s = document.createElement("script");
  s.src = API_URL + "?callback=" + cbName;

  s.onload = () => console.log("✅ JSONP Script loaded");
  s.onerror = () => setStatus("❌ JSONP script FAILED to load: " + s.src);

  document.body.appendChild(s);
}

window.onload = loadFromAPI_JSONP;
</script>
</body>
</html>
